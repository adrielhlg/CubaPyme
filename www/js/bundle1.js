(()=>{const e="https://cubapyme.mooo.com/api";var t=JSON.parse(localStorage.getItem("pymes"))||[],n=document.getElementById("spinner-overlay"),o=!1,a=window.localStorage.getItem("auth"),i=document.getElementById("miModal"),c=!1,s=0,r=0;function d(e){var t=document.getElementById(e);bootstrap.Offcanvas.getInstance(t).hide()}function l(n,o){document.getElementById("loading-image").style.display="flex",document.getElementById("products-container").innerHTML="";const a=`${e}/products/count?c_id=${pyme_id}`,i=t.find((e=>e.id===pyme_id));fetch(a).then((e=>e.json())).then((t=>{const a=Math.ceil(t/o),c=`${e}/products?c_id=${pyme_id}&start=${(n-1)*o}&end=${n*o}`;fetch(c).then((e=>e.json())).then((e=>{const t=document.getElementById("products-container");t.innerHTML="",e.forEach((e=>{const n=e.name,o=e.price;var a=e.image;0==e.desc&&(e.desc="");const c=document.createElement("div");a||(a="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"),c.innerHTML=`\n                            <div class="col-12 col-md-4 mb-4">\n                                <div class="card position-relative">                                    \n                                    <img src="data:image/png;base64,${a}" height="75" class="position-absolute top-0 end-0" alt="${n}">\n                                    <div class="card-body">\n                                        <h5 class="card-title" style="position: relative;" >${n}</h5>\n                                        <p class="card-text">Precio: $${o}</p>\n                                         Descripci&oacute;n del producto \n                                        <p class="card-text me-auto">${e.desc}</p>\n                                        <a href="whatsapp://send?phone=+53${encodeURIComponent(i.movil)}&text=Hola! Estoy interesado en el producto ${encodeURIComponent(n)} con el precio ${encodeURIComponent(o)}." class="position-absolute end-0" style="top: 80%;padding-right: 10px;" data-action="share/whatsapp/share"><img\n                                                src="images/whatsapp.png" alt=""></a>\n                                        \n                                    </div>\n                                </div>\n                            </div>                               \n                                `,t.appendChild(c)})),document.getElementById("loading-image").style.display="none",m(n,a)})).catch((e=>{document.getElementById("loading-image").style.display="none"}))})).catch((e=>{}))}function m(e,t,n=!1){const o=document.getElementById("pagination");o.innerHTML="";for(let a=1;a<=t;a++){const t=document.createElement("li");t.className="page-item"+(a===e?" active":"");const i=document.createElement("a");i.className="page-link",i.href="#",i.textContent=a,0==n?i.addEventListener("click",(()=>l(a,6))):i.addEventListener("click",(()=>u(a,6,n))),t.appendChild(i),o.appendChild(t)}}function u(n,o,a){document.getElementById("loading-image").style.display="flex",document.getElementById("products-container").innerHTML="";const i=`${e}/products/count?c_id=${pyme_id}&search=${encodeURIComponent(a)}`,c=document.getElementById("products-container");fetch(i).then((e=>e.json())).then((i=>{if(0==i)return void(c.innerHTML="No Hay Productos");const s=Math.ceil(i/o),r=t.find((e=>e.id===pyme_id)),d=`${e}/products?c_id=${pyme_id}&start=${(n-1)*o}&end=${n*o}&search=${encodeURIComponent(a)}`;fetch(d).then((e=>e.json())).then((e=>{c.innerHTML="",e.forEach((e=>{const t=e.name,n=e.price;var o=e.image;0==e.desc&&(e.desc="");const a=document.createElement("div");a.className="col-md-4 mb-4",o||(o="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"),a.innerHTML=`\n                            <div class="col-12 col-md-4 mb-4">\n                                <div class="card position-relative">                                    \n                                    <img src="data:image/png;base64,${o}" height="75" class="position-absolute top-0 end-0" alt="${t}">\n                                    <div class="card-body">\n                                        <h5 class="card-title" style="position: relative;" >${t}</h5>\n                                        <p class="card-text">Precio: $${n}</p>\n                                         Descripci&oacute;n del producto \n                                        <p class="card-text me-auto">${e.desc}</p>\n                                        <a href="whatsapp://send?phone=+53${encodeURIComponent(r.movil)}&text=Hola! Estoy interesado en el producto ${encodeURIComponent(t)} con el precio ${encodeURIComponent(n)}." class="position-absolute end-0" style="top: 80%;padding-right: 10px;" data-action="share/whatsapp/share"><img\n                                                src="images/whatsapp.png" alt=""></a>\n                                        \n                                    </div>\n                                </div>\n                            </div>                               \n                                `,c.appendChild(a)})),document.getElementById("loading-image").style.display="none",m(n,s,a)})).catch((e=>{document.getElementById("products-container").innerHTML="Error al obtener los productos.",document.getElementById("loading-image").style.display="none"}))})).catch((e=>{document.getElementById("products-container").innerHTML="Error al obtener el n�mero total de productos."}))}pyme_id=0,productsearched=null,a&&(o=JSON.parse(a).token,fetch(`${e}/resource?token=${o}`,{headers:{"Content-Type":"application/json"}}).then((e=>{401==e.status&&R()}))),document.getElementById("make_route").addEventListener("click",(function(){const e=t.find((e=>e.id===pyme_id));var n,o;d("offcanvasDerecho"),n=e.lat,o=e.log,T.getZoom(),navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,a=e.coords.longitude;control=L.Routing.control({waypoints:[L.latLng(t,a),L.latLng(n,o)],profile:"foot",language:"es"}),control.setPosition("bottomright").addTo(T);var i=L.DomUtil.create("button","leaflet-routing-clear-button");i.innerHTML="Borrar ruta",i.onclick=function(){T.removeControl(control),x()},control.getContainer().appendChild(i)}),(function(e){console.error("Error al obtener la ubicaci�n: "+e.message)})):console.error("Geolocalizaci�n no soportada por el navegador.")})),document.addEventListener("DOMContentLoaded",(function(){new bootstrap.Offcanvas(document.getElementById("offcanvasWithBothOptions"))._element.addEventListener("shown.bs.offcanvas",(function(){G()}))})),i.addEventListener("hidden.bs.modal",(function(e){document.getElementById("search-input").value="",productsearched=null})),document.getElementById("openModal").addEventListener("click",(function(){d("offcanvasDerecho");var e=new bootstrap.Modal(document.getElementById("miModal"));productsearched?(document.getElementById("search-input").value=productsearched,u(1,6,productsearched)):l(1,6),e.show()})),document.getElementById("search-input").addEventListener("input",(function(){const e=this.value.trim();""===e?l(1,6):u(1,6,e)}));const p=e+"/product_search";$("#demo-input").typeahead({filter:!1,hint:$(".Typeahead-hint"),menu:$(".Typeahead-menu"),classNames:{open:"is-open",empty:"is-empty",cursor:"is-active",suggestion:"Typeahead-suggestion",selectable:"Typeahead-selectable"},minLength:3,highlight:!0},{name:"productos",display:"name",source:function(e,t,n){$.ajax({url:p,data:{p:e,lat:s,long:r},dataType:"json",success:function(t){productsearched=e,$(".Typeahead-spinner").hide();var n;n=0!=s?t.map((e=>$('<div class="tt-suggestion tt-selectable" data-id="'+e.id+'"><strong>'+e.name+"</strong> ->"+e.distancia+" Km</div>"))):t.map((e=>$('<div class="tt-suggestion tt-selectable" data-id="'+e.id+'"><strong>'+e.name+"</strong></div>"))),$(".tt-dataset.tt-dataset-productos").empty().append(n)},error:function(e){$(".Typeahead-spinner").hide(),alert("Error al obtener los datos:",e)}})}}).on("typeahead:asyncrequest",(function(){$(".Typeahead-spinner").show()})).on("typeahead:asynccancel typeahead:asyncreceive",(function(){$(".Typeahead-spinner").hide()})),$(document).on("click",".tt-suggestion.tt-selectable",(function(){const e=$(this).data("id");productsearched=$("#demo-input").val();const n=t.find((t=>t.id===e));T.setView([n.lat,n.log],16),pyme_id=e,A(e)}));var g=null,y=null,f=L.icon({iconUrl:"images/marker-icon-2x.png",shadowUrl:"images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41]});function h(e){$("#status").text(e)}function v(e){1==e?($("#locate").val(y._latlng.lat+","+y._latlng.lng),K.show(),c=!1,T.removeLayer(y)):T.removeLayer(y)}function E(e){var t,n;s=e.coords.latitude,r=e.coords.longitude,t=e.coords.latitude,n=e.coords.longitude,T.setView([t,n],15),h("geoWin(): "+e),g&&T.removeLayer(g);var o=L.icon({iconUrl:"images/locate.png",iconSize:[32,32],iconAnchor:[16,32]});g=L.marker([e.coords.latitude,e.coords.longitude],{icon:o}).addTo(T),k()}function b(e){}function I(){h("startGeoWatch()"),opt={timeout:1e3,enableHighAccuracy:!0},w=navigator.geolocation.watchPosition(E,b,opt)}function x(){navigator.geolocation.clearWatch(w)}function k(){x()}function M(){I()}function A(n){totalView=0;const o=document.getElementById("offcanvasDerecho"),a=new bootstrap.Offcanvas(o),i=document.getElementById("cardPymeInfo");"string"==typeof t&&(data=JSON.parse(data));var c=t.find((e=>e.id===n));!async function(){try{const t=await async function(){const t=`${e}/products/count?c_id=${pyme_id}`;try{const e=await fetch(t);return await e.json()}catch(e){throw e}}();c.t_prod=t}catch(e){console.log("Error al obtener el total de productos: "+e)}}(),i.innerHTML=`\n                <div class="mt-3 mb-4 text-center">\n                <img class="rounded-circle img-fluid" src="images/pyme.jpg" style="width: 100px;">\n            </div>\n            <h4 class="text-center" >${c.name}</h4>                                   \n            <div class="container mt-4">\n                <div class="card border-0">\n                    <div class="bi">                        \n                        <p class="card-text"><strong>Correo:</strong> ${c.email}</p>\n                        <p class="card-text"><strong>Tel&eacute;fono:</strong> ${c.movil}</p>\n                        <p class="card-text"><strong>Direcci&oacute;n:</strong> ${c.street}</p>\n                        <p class="card-text"><strong>Actividad:</strong> ${c.activity}</p>\n                    </div>\n                </div>\n            </div>\n            \n                \n\x3c!--            <div class="mb-4 mt-4 pb-2 text-center">--\x3e\n\x3c!--                <button class="btn btn-outline-primary btn-floating" type="button">--\x3e\n\x3c!--                    <i class="fab fa-facebook-f fa-lg"></i>--\x3e\n\x3c!--                </button>--\x3e\n\x3c!--                <button class="btn btn-outline-primary btn-floating" type="button">--\x3e\n\x3c!--                    <i class="fab fa-twitter fa-lg"></i>--\x3e\n\x3c!--                </button>--\x3e\n\x3c!--                <button class="btn btn-outline-primary btn-floating" type="button">--\x3e\n\x3c!--                    <i class="fab fa-skype fa-lg"></i>--\x3e\n\x3c!--                </button>--\x3e\n\x3c!--            </div>--\x3e\n\n            <div class="d-flex justify-content-between text-center mt-5 mb-2">\n                <div>\n                    <p class="mb-2 h5">${c.t_prod}</p>\n                    <p class="text-muted mb-0">Total de Productos</p>\n                </div>\n                <div class="px-3">\n                    <p id="totalView" class="mb-2 h5"></p>\n                    <p class="text-muted mb-0">Total Views</p>\n                </div>\n                <div>\n\x3c!--                    <p class="mb-2 h5">4752</p>--\x3e\n\x3c!--                    <p class="text-muted mb-0">Total Transactions</p>--\x3e\n                </div>\n            </div>\n                    \n            `,async function(){try{const t=await async function(){const t=`${e}/get_view?c_id=${pyme_id}`;try{const e=await fetch(t);return await e.json()}catch(e){throw e}}();$("#totalView").text(t)}catch(e){console.log("Error al obtener el total de productos: "+e)}}(),a.show()}function O(){(JSON.parse(localStorage.getItem("pymes"))||[]).forEach((e=>{const t=e.name,n=e.lat,o=e.log;var a=L.marker([n,o],{icon:f,title:t}).addTo(T);a.bindTooltip(t,{permanent:!0,direction:"top",offset:[0,-25]}),a.on("click",(function(t){T.getZoom()<=14&&T.setView([n,o],17),pyme_id=e.id,A(pyme_id)}))}))}var w=null,T=null;$(document).ready((function(){!function(){var e=window.localStorage.getItem("mapPosition"),t=window.localStorage.getItem("mapZoom");T=new L.Map("map"),$("#map").height($(window).height()),T.on("click",(function(e){c&&(L.icon({iconUrl:"images/locate.png",iconSize:[32,32],iconAnchor:[16,32]}),y=L.marker([e.latlng.lat,e.latlng.lng],{icon:f}).addTo(T),navigator.notification.confirm("Está es la ubicación correcta!",v,"Información",["Aceptar","Volver"]))})),url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",opt={minZoom:7,attribution:"OSM"};var n=new L.TileLayer(url,opt);T.whenReady((function(){T.removeControl(T.zoomControl)}));var o=L.control({position:"topleft"});if(o.onAdd=function(e){var t=L.DomUtil.create("div","location leaflet-bar leaflet-control"),n=L.DomUtil.create("a","leaflet-bar-part",t);return n.title="Mi ubicaci�n",n.innerHTML='<i class="fas fa-map-marker-alt"></i>',L.DomEvent.on(n,"click",(function(){I()})),t},o.addTo(T),L.control.zoom({position:"topleft"}).addTo(T),T.addLayer(n),e&&t){var a=JSON.parse(e),i=parseInt(t);T.setView(a,i)}else T.setView(new L.LatLng(21.396819,-79.282837),7);T.on("moveend",(function(){var e=T.getCenter(),t=T.getZoom();window.localStorage.setItem("mapPosition",JSON.stringify(e)),window.localStorage.setItem("mapZoom",t.toString())}))}(),O(),fetch(`${e}/pymes`).then((e=>e.json())).then((e=>{const t=JSON.parse(localStorage.getItem("pymes"))||[];JSON.stringify(e)!==JSON.stringify(t)&&(localStorage.setItem("pymes",JSON.stringify(e)),T.eachLayer((function(e){e instanceof L.Marker&&T.removeLayer(e)})),O(),document.location.href="index.html")})).catch((e=>{console.error("Error al obtener los datos:",e)}))})),document.addEventListener("deviceready",(function(){document.addEventListener("pause",k,!1),document.addEventListener("resume",M,!1)}),!1);const B=document.getElementById("loginForm");function R(){localStorage.removeItem("auth"),location.reload()}function V(e){var t=JSON.parse(e);document.getElementById("loginForm").style.display="none",document.getElementById("infoUser").style.display="block",document.getElementById("displayname").innerHTML=t.displayname,document.getElementById("email").innerHTML=t.email}function j(){document.getElementById("spinner_login").classList.add("d-none")}document.getElementById("signout").addEventListener("click",(function(){R()})),a&&V(a),$("#SigninBtn").click((function(){const t=document.getElementById("username").value,n=document.getElementById("password").value,a=B.querySelectorAll("input");var i=0;if(a.forEach((function(e){e.value?e.classList.remove("campo-requerido"):(e.classList.add("campo-requerido"),i++)})),!1===B.checkValidity()&&event.preventDefault(),0==i){document.getElementById("spinner_login").classList.remove("d-none");const a={username:t,password:n};fetch(e+"/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.json())).then((e=>{if(j(),e.token){window.localStorage.setItem("auth",JSON.stringify(e));var t=window.localStorage.getItem("auth");o=JSON.parse(t).token,G(),V(t)}else document.getElementById("alertaError").classList.remove("d-none"),console.log("Credenciales incorrectas. Mensaje:",e.error)})).catch((e=>{j(),navigator.notification.alert("No se ha podido conectar con el servidor!",null,"Error","Aceptar")}))}}));const S=document.getElementById("createPyme");var K=new bootstrap.Modal(document.getElementById("agregarPymeModal"));function P(t){if(1==t){const t=document.getElementById("registerPyme"),a=document.getElementById("pymename").value,i=document.getElementById("numero_exp").value,c=document.getElementById("telefono").value,s=document.getElementById("direccion").value,r=document.getElementById("actividad").value,d=document.getElementById("locate").value;n.style.display="block",fetch(`${e}/registerPyme`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({numero_exp:i,pymename:a,telefono:c,direccion:s,actividad:r,geolocation:d,token:o})}).then((e=>e.json())).then((e=>{e.success?(navigator.notification.alert("Su solicitud está pendiente a aprobación!",null,"Solicirud de Pyme","Aceptar"),t.reset(),G(),n.style.display="none"):(n.style.display="none",navigator.notification.alert(e.msg,null,"Error","Aceptar"))})).catch((e=>{n.style.display="none",alert("Error en el registro "+e)}))}}function G(){o&&fetch(`${e}/getPyme?token=${o}`).then((e=>e.json())).then((e=>{!function(e){const t=document.getElementById("tabla-solicitudes").getElementsByTagName("tbody")[0];t.innerHTML="";for(const n of e){const e=t.insertRow();if(e.insertCell().textContent=n.pymename,e.insertCell().textContent=n.telefono,e.insertCell().textContent=n.direccion,e.insertCell().textContent=n.estado,"aprobada"==n.estado){const e=document.getElementById("botonProductos");e.style.display="var(--fa-display,inline-block)",e.addEventListener("click",(function(){document.location.href="./product.html"}))}}}(e),document.getElementById("tabla-solicitudes").style.display="block"})).catch((e=>{console.error("Error al obtener los datos:",e)}))}document.getElementById("btnAddPyme").addEventListener("click",(function(){d("offcanvasWithBothOptions"),document.getElementById("locate").value="",K.show()})),document.getElementById("geolocalizacion").addEventListener("click",(e=>{e.preventDefault(),c=!0;var t=document.querySelector(".toast");new bootstrap.Toast(t).show(),K.hide()})),S.addEventListener("click",(e=>{const t=document.getElementById("registerPyme"),n=t.querySelectorAll("input");var o=0;n.forEach((function(e){e.value?e.classList.remove("campo-requerido"):(e.classList.add("campo-requerido"),"locate"==e.id&&document.getElementById("geolocalizacion").classList.add("campo-requerido"),o++)})),!1===t.checkValidity()&&e.preventDefault(),0==o&&navigator.notification.confirm("Está seguro que toda la información es correcta!",P,"Información",["Aceptar","Volver"])}))})();