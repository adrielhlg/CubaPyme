(()=>{var e=!1,t=window.localStorage.getItem("auth");productsearched=null,t&&(e=JSON.parse(t).token);const n="https://cubapyme.mooo.com/api";function a(){$("#spinner").show(),$.ajax({url:n+"/productManager",type:"GET",data:{token:e},dataType:"json",success:function(t){$("#spinner").hide(),$("#productosTabla").empty(),$.each(t,(function(e,t){const n=t.status?"checked":"";0==t.desc?producto_desc="":producto_desc=t.desc;const a=`\n            <label class="switch">\n              <input type="checkbox" class="toggleHabilitado" data-id="${t.id}" ${n}>\n              <span class="slider round"></span>\n            </label>\n          `;$("#productosTabla").append(`\n            <tr>\n              <td><img src="data:image/png;base64,${t.image}" height="50" alt="N/A"> ${t.name}</td>\n              <td>${t.price}</td>\n              <td>${a}</td>\n              <td>\n                <button type="button" class="btnEditar" data-id="${t.id}" data-nombre="${t.name}" data-precio="${t.price}" data-desc="${producto_desc}"><img src="./img/edit.png" alt="Imagen de ejemplo" width="30" height="30"></button>\n                <button type="button" class="btnEliminar" data-id="${t.id}"><img src="./img/delete.png" alt="Imagen de ejemplo" width="30" height="30"></button>\n              </td>\n            </tr>\n          `)})),$(".toggleHabilitado").change((function(){const e=$(this).data("id"),t=$(this).prop("checked"),n=new FormData;n.append("id",e),n.append("estado",t),d(e,n)})),$(".btnEliminar").click((function(){!function(t){const d=new FormData;d.append("id",t),d.append("token",e),navigator.notification.confirm("Estás seguro que desea eliminar el producto",(function(e){if(1==e){o.style.display="block";const e=`${n}/delete_product`;$("#spinner").show(),$.ajax({url:e,type:"POST",data:d,processData:!1,contentType:!1,success:function(e){o.style.display="none",a()},error:function(e){navigator.notification.alert("Error al guardar el producto: "+e,null,"CubaPyme","Aceptar")},complete:function(){$("#spinner").hide()}})}}),"Información",["Aceptar","Volver"])}($(this).data("id"))}))},error:function(e,t,n){$("#spinner").hide()}})}$("#modalAgregar").on("show.bs.modal",(function(e){$("#imagen").val("")}));var o=document.getElementById("spinner-overlay");function d(t,d){d.append("token",e);const i=t?`${n}/update_product`:n+"/create_product";o.style.display="block",$.ajax({url:i,type:"POST",data:d,processData:!1,contentType:!1,success:function(e){o.style.display="none";var t=new bootstrap.Modal(document.getElementById("modalAgregar"));$("#productForm")[0].reset(),$("#imagenPreview").html(""),$("#btnActualizar").hide(),$("#btnEliminar").hide(),$("#btnAgregar").show(),a(),t.hide()},error:function(e){o.style.display="none",alert("Error al guardar el producto:",e)},complete:function(){$("#spinner").hide()}})}$(document).on("click",".btnEditar",(function(){const e=$(this).data("id"),t=$(this).data("nombre"),n=$(this).data("precio"),a=$(this).data("desc");var o=tinymce.get("editdescripcion");o?o.setContent(a):console.error("Editor instance not found."),$("#idproduct").val(e),$("#editNombre").val(t),$("#editPrecio").val(n),$("#editdescripcion").text(a),$("#editImagen").val(""),$("#modalEditar").modal("show"),$("#editProductForm").submit((function(e){e.preventDefault();const t=$("#idproduct").val(),n=$("#editNombre").val(),a=$("#editPrecio").val(),o=$("#editdescripcion").val(),i=new FormData;i.append("id",t),i.append("nombre",n),i.append("precio",a),i.append("desc",o);const c=$("#editImagen")[0].files[0];if(c){const e=new FileReader;e.onloadend=function(){const n=e.result.split(",")[1];i.append("imagen",n),d(t,i),$("#modalEditar").modal("hide")},e.readAsDataURL(c)}else d(t,i),$("#modalEditar").modal("hide")}))})),document.getElementById("productForm").addEventListener("submit",(e=>{e.preventDefault();const t=new FormData,n=$("#nombre").val(),a=$("#precio").val(),i=tinymce.get("descripcionproduct").getContent();t.append("nombre",n),t.append("precio",a),t.append("desc",i),o.style.display="block";const c=$("#imagen")[0].files[0];if(c){const e=new FileReader;e.onloadend=function(){const n=e.result.split(",")[1];t.append("imagen",n),d(null,t)},e.readAsDataURL(c)}else d(null,t);o.style.display="none"})),a()})();